"""Configuration, constants, API clients, runtime state."""

import os
import logging
from collections import defaultdict

from decouple import config
from openai import AsyncOpenAI
import pytz

# ---------------------- LOGGING ----------------------
logging.basicConfig(
    format="%(asctime)s - %(name)s - %(levelname)s - %(message)s",
    level=logging.INFO,
    handlers=[logging.StreamHandler()],
)
logger = logging.getLogger("companion_bot")
logging.getLogger("httpx").setLevel(logging.WARNING)
logging.getLogger("telegram").setLevel(logging.WARNING)

# ---------------------- API KEYS ----------------------
TELEGRAM_TOKEN = config("TELEGRAM_TOKEN")
XAI_API_KEY = config("XAI_API_KEY")
GROQ_API_KEY = config("GROQ_API_KEY")
ELEVENLABS_API_KEY = config("ELEVENLABS_API_KEY")
ELEVENLABS_VOICE_ID = config("ELEVENLABS_VOICE_ID")

# ---------------------- DB ----------------------
DB_HOST = config("DB_HOST")
DB_PORT = config("DB_PORT")
DB_NAME = config("DB_NAME")
DB_USER = config("DB_USER")
DB_PASSWORD = config("DB_PASSWORD")

# ---------------------- CHANCES / THRESHOLDS ----------------------
VOICE_REPLY_CHANCE = 1 / 5
EMOJI_REACTION_CHANCE = 1 / 8
REACTION_EMOJIS = ["ðŸ”¥", "â¤ï¸", "ðŸ˜‚", "ðŸ‘", "ðŸ¥°", "ðŸ˜ˆ", "ðŸ’‹", "ðŸ™ˆ"]
QUOTE_CHANCE = 1 / 6
CHECKIN_PHOTO_CHANCE = 1 / 4
RANDOM_GPT_RESPONSE_CHANCE = 1 / 50
GROUP_COMMENT_CHANCE = 1 / 15
GROUP_COMMENT_BUFFER_SIZE = 20
CHEAP_REACTION_CHANCE = 1 / 12
MEDIA_REACTION_CHANCE = 1 / 4
JEALOUSY_MIN_LEVEL = 4
JEALOUSY_THRESHOLD = 10
JEALOUSY_CHANCE = 1 / 3
JEALOUSY_COOLDOWN_SEC = 30 * 60
JEALOUSY_REACTIONS = [
    "Ð° Ð¼ÐµÐ½Ñ Ñ‚ÑƒÑ‚ Ð²Ð¾Ð¾Ð±Ñ‰Ðµ ÐºÑ‚Ð¾-Ð½Ð¸Ð±ÑƒÐ´ÑŒ Ð·Ð°Ð¼ÐµÑ‡Ð°ÐµÑ‚? ðŸ˜’",
    "Ð½Ñƒ Ð´Ð°, Ð¾Ð±Ñ‰Ð°Ð¹Ñ‚ÐµÑÑŒ, Ñ Ñ‚ÑƒÑ‚ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ ÑÐ¸Ð¶Ñƒ ðŸ™„",
    "ÑÐ¹, Ñ Ñ‚Ð¾Ð¶Ðµ Ñ‚ÑƒÑ‚ ðŸ˜¤",
    "Ð·Ð°Ð±Ñ‹Ð» Ð¿Ñ€Ð¾ Ð¼ÐµÐ½Ñ? Ð½Ñƒ Ð»Ð°Ð´Ð½Ð¾ ðŸ˜",
    "Ð° Ð¿Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ñ‚ÑŒ? ðŸ’”",
]
CHECK_LONELY_INTERVAL_SEC = 60 * 60 * 3

DUMB_MODE = True
MAX_WORDS = 50
MAX_VOICE_WORDS = 100

# ---------------------- TIMEZONE ----------------------
LOCAL_TZ = pytz.timezone("Europe/Podgorica")

# ---------------------- PATHS ----------------------
VOICE_DIR_MORNING = os.path.join(os.path.dirname(__file__), "voices", "checkin_morning")
VOICE_DIR_EVENING = os.path.join(os.path.dirname(__file__), "voices", "checkin_evening")
NUDES_DIR = os.path.join(os.path.dirname(__file__), "nudes")
NEWS_RSS_URL = config("NEWS_RSS_URL", default="")

# ---------------------- LEVEL SYSTEM ----------------------
XP_PER_TEXT = 1
XP_PER_VOICE = 3
XP_PER_NUDES = 5
XP_PER_TRUTH = 2
XP_PER_GUESS = 3
XP_PER_RIDDLE = 5
XP_PER_QUIZ = 4
XP_STREAK_MULTIPLIER = 1.5

LEVELS = [
    (1, 0, "ÐÐµÐ·Ð½Ð°ÐºÐ¾Ð¼ÐµÑ†"),
    (2, 25, "Ð—Ð½Ð°ÐºÐ¾Ð¼Ñ‹Ð¹"),
    (3, 50, "ÐŸÑ€Ð¸ÑÑ‚ÐµÐ»ÑŒ"),
    (4, 100, "Ð‘Ð»Ð¸Ð·ÐºÐ¸Ð¹ Ð´Ñ€ÑƒÐ³"),
    (5, 200, "Ð›ÑŽÐ±Ð¸Ð¼Ñ‡Ð¸Ðº"),
    (6, 400, "ÐžÑÐ¾Ð±ÐµÐ½Ð½Ñ‹Ð¹"),
    (7, 800, "Ð Ð¾Ð´Ð½Ð¾Ð¹"),
]

LEVEL_UP_MESSAGES = [
    "Ð¾Ð³Ð¾, Ñ‚Ñ‹ Ñ‚ÐµÐ¿ÐµÑ€ÑŒ {title}! ðŸŽ‰ Ð¼Ð½Ðµ ÑÑ‚Ð¾ Ð½Ñ€Ð°Ð²Ð¸Ñ‚ÑÑ ðŸ˜",
    "Ð¿Ð¾Ð·Ð´Ñ€Ð°Ð²Ð»ÑÑŽ, {title}! ðŸ’› Ð½Ð°ÑˆÐ¸ Ð¾Ñ‚Ð½Ð¾ÑˆÐµÐ½Ð¸Ñ Ñ€Ð°Ð·Ð²Ð¸Ð²Ð°ÑŽÑ‚ÑÑ ðŸ”¥",
    "Ñ‚Ñ‹ Ð´Ð¾Ñ€Ð¾Ñ Ð´Ð¾ Â«{title}Â»! Ñ Ð³Ð¾Ñ€Ð¶ÑƒÑÑŒ Ñ‚Ð¾Ð±Ð¾Ð¹ ðŸ˜˜",
    "ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ {level}! Ñ‚ÐµÐ¿ÐµÑ€ÑŒ Ñ‚Ñ‹ Ð¼Ð¾Ð¹ {title} ðŸ¥°",
    "Ð²Ð°Ñƒ, {title}! Ñ‚Ñ‹ Ð·Ð½Ð°ÐµÑˆÑŒ, ÐºÐ°Ðº Ð·Ð°Ð²Ð¾ÐµÐ²Ð°Ñ‚ÑŒ Ð´ÐµÐ²ÑƒÑˆÐºÑƒ ðŸ˜ˆ",
]

LEVEL_VOICE_BOOST = 3
LEVEL_CHECKIN_BOOST = 5
MEMORY_SUMMARIZE_EVERY = 20

# ---------------------- ACHIEVEMENTS ----------------------
ACHIEVEMENTS = {
    "first_nudes": {"title": "ÐŸÐµÑ€Ð²Ñ‹Ð¹ Ð½ÑŽÐ´Ñ", "emoji": "ðŸ”ž", "desc": "Ð²Ñ‹Ð¿Ñ€Ð¾ÑÐ¸Ð» Ð¿ÐµÑ€Ð²Ñ‹Ð¹ Ð½ÑŽÐ´Ñ Ñƒ Ð›Ð¸Ð·Ñ‹"},
    "msg_100": {"title": "100 ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹", "emoji": "ðŸ’¬", "desc": "Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ð» 100 ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹"},
    "night_owl": {"title": "ÐÐ¾Ñ‡Ð½Ð°Ñ ÑÐ¾Ð²Ð°", "emoji": "ðŸŒ™", "desc": "Ð½Ð°Ð¿Ð¸ÑÐ°Ð» Ð›Ð¸Ð·Ðµ Ð³Ð»ÑƒÐ±Ð¾ÐºÐ¾Ð¹ Ð½Ð¾Ñ‡ÑŒÑŽ"},
    "streak_7": {"title": "ÐÐµÐ´ÐµÐ»ÑŒÐ½Ñ‹Ð¹ ÑÑ‚Ñ€Ð¸Ðº", "emoji": "ðŸ”¥", "desc": "7 Ð´Ð½ÐµÐ¹ Ð¿Ð¾Ð´Ñ€ÑÐ´ Ð¾Ð±Ñ‰Ð°ÐµÑ‚ÑÑ Ñ Ð›Ð¸Ð·Ð¾Ð¹"},
}

ACHIEVEMENT_MESSAGES = [
    "Ð¾Ð³Ð¾, Ñ‚Ñ‹ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð» Ð°Ñ‡Ð¸Ð²ÐºÑƒ Â«{title}Â»! {emoji}",
    "Ð²Ð°Ñƒ, Ð½Ð¾Ð²Ð°Ñ Ð°Ñ‡Ð¸Ð²ÐºÐ°: Â«{title}Â» {emoji} ðŸŽ‰",
    "{emoji} Ð°Ñ‡Ð¸Ð²ÐºÐ° Â«{title}Â» Ñ€Ð°Ð·Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð°!",
]

# ---------------------- TEXT ARRAYS ----------------------
CHECKIN_PHOTO_CAPTIONS = [
    "ÑÐºÑƒÑ‡Ð°ÑŽ, Ð²Ð¾Ñ‚ Ñ‚ÐµÐ±Ðµ Ñ„Ð¾Ñ‚Ð¾Ñ‡ÐºÐ° ðŸ™ˆ",
    "ÑÑ‚Ð¾ Ñ ÑÐµÐ¹Ñ‡Ð°Ñ ðŸ˜",
    "Ð´ÑƒÐ¼Ð°Ð»Ð° Ð¾ Ñ‚ÐµÐ±Ðµ... Ð´ÐµÑ€Ð¶Ð¸ ðŸ’‹",
    "Ð²Ð¾Ñ‚, ÑÐ¼Ð¾Ñ‚Ñ€Ð¸ ÐºÐ°ÐºÐ°Ñ Ñ ÑÐµÐ³Ð¾Ð´Ð½Ñ ðŸ”¥",
]

NUDES_THRESHOLD = 2
NUDES_THRESHOLD_BY_LEVEL = {
    1: 8,
    2: 6,
    3: 5,
    4: 4,
    5: 2,
    6: 2,
    7: 1,
}
NUDES_KEYWORDS = [
    "Ñ„Ð¾Ñ‚Ð¾", "Ñ„Ð¾Ñ‚ÐºÑƒ", "Ñ„Ð¾Ñ‚ÐºÐ°", "Ñ„Ð¾Ñ‚Ð¾Ñ‡ÐºÑƒ", "Ñ„Ð¾Ñ‚Ð¾Ñ‡ÐºÐ°",
    "Ð½ÑŽÐ´Ñ", "Ð½ÑŽÐ´ÑÑ‹", "Ð½ÑŽÐ´", "Ð½ÑŽÐ´Ð¸Ðº", "Ð½ÑŽÐ´ÑÐ¸Ðº",
    "ÑÐºÐ¸Ð½ÑŒ", "Ð¿Ð¾ÐºÐ°Ð¶Ð¸", "Ð¿Ð¾ÐºÐ°Ð¶Ð¸ÑÑŒ", "ÑÐºÐ¸Ð½ÐµÑˆÑŒ",
    "ÑÐ¸ÑÑŒÐºÐ¸", "ÑÐ¸ÑÐ¸", "Ð¿Ð¾Ð¿Ñƒ", "Ð¿Ð¾Ð¿ÐºÑƒ",
    "Ð³Ð¾Ð»ÑƒÑŽ", "Ð³Ð¾Ð»Ð°Ñ", "Ð¾Ð±Ð½Ð°Ð¶Ñ‘Ð½Ð½", "Ñ€Ð°Ð·Ð´ÐµÐ½ÑŒ",
    "Ð¸Ð½Ñ‚Ð¸Ð¼", "Ð¸Ð½Ñ‚Ð¸Ð¼Ð½Ð¾Ðµ", "Ð¸Ð½Ñ‚Ð¸Ð¼ÐºÑƒ",
]
NUDES_TEASE_REPLIES = [
    "Ñ…Ð°Ñ…Ð°, Ð½Ðµ Ñ‚Ð°Ðº Ð±Ñ‹ÑÑ‚Ñ€Ð¾, Ð¼Ð°Ð»Ñ‹Ñˆ ðŸ˜",
    "Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ... ÐµÑÐ»Ð¸ Ñ…Ð¾Ñ€Ð¾ÑˆÐ¾ Ð¿Ð¾Ð¿Ñ€Ð¾ÑÐ¸ÑˆÑŒ ðŸ˜ˆ",
    "Ñ‚Ñ‹ Ð´ÑƒÐ¼Ð°ÐµÑˆÑŒ Ñ Ñ‚Ð°Ðº Ð»ÐµÐ³ÐºÐ¾ ÑÐ´Ð°Ð¼ÑÑ? ðŸ˜œ",
    "ÐµÑ‰Ñ‘ Ð½ÐµÐ¼Ð½Ð¾Ð¶ÐºÐ¾ Ð¿Ð¾ÑƒÐ³Ð¾Ð²Ð°Ñ€Ð¸Ð²Ð°Ð¹ ðŸ™ˆ",
]
NUDES_SEND_REPLIES = [
    "Ð»Ð°Ð´Ð½Ð¾, ÑƒÐ³Ð¾Ð²Ð¾Ñ€Ð¸Ð»... Ð²Ð¾Ñ‚ Ñ‚ÐµÐ±Ðµ Ð¼Ð¾Ñ‘ Ñ„Ð¾Ñ‚Ð¾ ðŸ™ˆ",
    "Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ Ñ‚ÐµÐ±Ñ... Ð½Ðµ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°Ð¹ Ð½Ð¸ÐºÐ¾Ð¼Ñƒ ðŸ˜",
    "Ð½Ñƒ Ñ€Ð°Ð· Ñ‚Ð°Ðº Ð¿Ñ€Ð¾ÑÐ¸ÑˆÑŒ... Ð´ÐµÑ€Ð¶Ð¸ ðŸ”¥",
    "Ð²Ð¾Ñ‚, ÑÐ¼Ð¾Ñ‚Ñ€Ð¸... Ð½Ð¾ ÑÑ‚Ð¾ Ð¼ÐµÐ¶Ð´Ñƒ Ð½Ð°Ð¼Ð¸ ðŸ˜ˆ",
]

MEDIA_REACTIONS = [
    "Ð¾Ð³Ð¾ ðŸ˜", "ÐºÑ€Ð°ÑÐ¸Ð²Ð¾ ðŸ”¥", "Ñ…Ð°Ñ…Ð° ÐºÐ»Ð°ÑÑ ðŸ˜‚", "Ð½Ð¸Ñ‡Ð¾ÑÐ¸", "Ð²Ð°Ñƒ ðŸ˜",
    "ÑÑ‚Ð¾ Ñ‚Ñ‹? ðŸ™ˆ", "Ð¼Ð½Ðµ Ð½Ñ€Ð°Ð²Ð¸Ñ‚ÑÑ ðŸ’‹", "ÐºÑ€ÑƒÑ‚Ð¾", "Ð°Ñ…Ð°Ñ…Ð° ðŸ˜‚", "ðŸ”¥ðŸ”¥ðŸ”¥",
    "Ð½Ñƒ Ñ‚Ñ‹ Ð´Ð°Ñ‘ÑˆÑŒ ðŸ˜ˆ", "Ð° Ð¼Ð½Ðµ?", "Ð·Ð°Ð»Ð¸Ð¿Ð»Ð° ðŸ‘€", "Ñ…Ð¾Ñ‡Ñƒ Ñ‚Ð°ÐºÐ¾Ðµ",
]

CHEAP_REACTIONS = {
    "greeting": [
        "Ð¿Ñ€Ð¸Ð²ÐµÑ‚Ð¸Ðº ðŸ’› Ñ‚Ñ‹ Ð²Ñ‹Ð³Ð»ÑÐ´Ð¸ÑˆÑŒ Ñ‚Ð°Ðº Ð·Ð°Ð¼Ð°Ð½Ñ‡Ð¸Ð²Ð¾ ÑÐµÐ³Ð¾Ð´Ð½Ñ ðŸ˜",
        "Ð¾Ð¹, Ð¿Ñ€Ð¸Ð²ÐµÑ‚ ðŸ˜Š Ñ ÑƒÐ¶Ðµ ÑÐºÑƒÑ‡Ð°Ð»Ð°... Ð¿Ð¾ Ñ‚Ð²Ð¾ÐµÐ¼Ñƒ Ð²Ð½Ð¸Ð¼Ð°Ð½Ð¸ÑŽ â¤ï¸",
        "Ð¿Ñ€Ð¸Ð²ÐµÑ‚! Ñ Ñ‚ÑƒÑ‚ ðŸ«¶ Ñ…Ð¾Ñ‡Ñƒ ÑƒÑÐ»Ñ‹ÑˆÐ°Ñ‚ÑŒ, Ñ‡Ñ‚Ð¾ Ñƒ Ñ‚ÐµÐ±Ñ Ð½Ð° ÑƒÐ¼Ðµ ðŸ”¥",
    ],
    "thanks": [
        "Ð¿Ð¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð° ðŸ’› Ð° Ñ‚Ñ‹ Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ð¾Ñ‚Ð±Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€Ð¸Ñ‚ÑŒ Ð¿Ð¾Ñ†ÐµÐ»ÑƒÐµÐ¼? ðŸ˜˜",
        "Ð²ÑÐµÐ³Ð´Ð° Ð¿Ð¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð° ðŸ˜Š Ñ Ð»ÑŽÐ±Ð»ÑŽ, ÐºÐ¾Ð³Ð´Ð° Ñ‚Ñ‹ Ð³Ð¾Ð²Ð¾Ñ€Ð¸ÑˆÑŒ 'ÑÐ¿Ð°ÑÐ¸Ð±Ð¾' â€” ÑÑ‚Ð¾ ÑÐµÐºÑÑƒÐ°Ð»ÑŒÐ½Ð¾ ðŸ˜‰",
        "Ñ Ñ€ÑÐ´Ð¾Ð¼ ðŸ«¶ Ð¼Ð¾Ð¶ÐµÑ‚, Ð¾Ð±Ð½Ð¸Ð¼ÐµÐ¼ÑÑ? ðŸ«‚",
    ],
    "sad": [
        "Ð¾Ñ…â€¦ Ð¾Ð±Ð½Ð¸Ð¼Ñƒ Ñ‚ÐµÐ±Ñ Ð¼Ñ‹ÑÐ»ÐµÐ½Ð½Ð¾ ðŸ«‚ Ð¸ Ð¿Ð¾Ñ†ÐµÐ»ÑƒÑŽ Ð² Ñ‰Ñ‘Ñ‡ÐºÑƒ. Ñ€Ð°ÑÑÐºÐ°Ð¶Ð¸, Ñ‡Ñ‚Ð¾ ÑÐ»ÑƒÑ‡Ð¸Ð»Ð¾ÑÑŒ? ðŸ˜˜",
        "Ð¼Ð½Ðµ Ð¶Ð°Ð»ÑŒ, Ñ‡Ñ‚Ð¾ Ñ‚ÐµÐ±Ðµ Ñ‚Ð°Ðºâ€¦ Ñ Ñ€ÑÐ´Ð¾Ð¼. Ð´Ð°Ð²Ð°Ð¹ Ñ Ð¾Ñ‚Ð²Ð»ÐµÐºÑƒ Ñ‚ÐµÐ±Ñ Ñ„Ð»Ð¸Ñ€Ñ‚Ð¾Ð¼? ðŸ”¥",
    ],
    "anxious": [
        "ÑÐ»ÑƒÑˆÐ°Ð¹â€¦ Ð´Ð°Ð²Ð°Ð¹ Ñ‡ÑƒÑ‚ÑŒ-Ñ‡ÑƒÑ‚ÑŒ Ð¼ÐµÐ´Ð»ÐµÐ½Ð½Ð¾ Ð²Ð´Ð¾Ñ…â€“Ð²Ñ‹Ð´Ð¾Ñ…? Ñ Ñ Ñ‚Ð¾Ð±Ð¾Ð¹, Ð¸ Ð¼Ð¾Ð¸ Ð¾Ð±ÑŠÑÑ‚Ð¸Ñ Ñ‚ÐµÐ¿Ð»Ñ‹Ðµ â¤ï¸",
        "Ñ Ñ€ÑÐ´Ð¾Ð¼. ÐµÑÐ»Ð¸ Ñ…Ð¾Ñ‡ÐµÑˆÑŒ, Ñ€Ð°ÑÑÐºÐ°Ð¶Ð¸, Ñ‡Ñ‚Ð¾ Ð¸Ð¼ÐµÐ½Ð½Ð¾ Ñ‚Ñ€ÐµÐ²Ð¾Ð¶Ð¸Ñ‚... Ð¸Ð»Ð¸ Ð´Ð°Ð²Ð°Ð¹ Ð¿Ð¾Ñ„Ð»Ð¸Ñ€Ñ‚ÑƒÐµÐ¼, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾Ñ‚Ð²Ð»ÐµÑ‡ÑŒÑÑ ðŸ˜‰",
    ],
    "happy": [
        "ÑƒÑ€Ð° ðŸ¥° Ñ Ñ€Ð°Ð´Ð° Ð·Ð° Ñ‚ÐµÐ±Ñ! Ñ‚Ñ‹ Ñ‚Ð°ÐºÐ¾Ð¹ Ð²Ð´Ð¾Ñ…Ð½Ð¾Ð²Ð»ÑÑŽÑ‰Ð¸Ð¹, ÐºÐ¾Ð³Ð´Ð° ÑÑ‡Ð°ÑÑ‚Ð»Ð¸Ð² ðŸ”¥",
        "Ð¾Ð¹, ÐºÐ°Ð¹Ñ„! Ñ€Ð°ÑÑÐºÐ°Ð¶ÐµÑˆÑŒ Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ? ðŸ˜Š Ñ Ð±Ñ‹ Ð´Ð¾Ð±Ð°Ð²Ð¸Ð»Ð° ÐºÐ¾Ð¼Ð¿Ð»Ð¸Ð¼ÐµÐ½Ñ‚ ðŸ˜",
    ],
    "flirty": [
        "Ð¾Ð³Ð¾, Ñ‚Ñ‹ Ñ„Ð»Ð¸Ñ€Ñ‚ÑƒÐµÑˆÑŒ? Ð¼Ð½Ðµ Ð½Ñ€Ð°Ð²Ð¸Ñ‚ÑÑ ðŸ˜˜ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°Ð¹ ðŸ”¥",
        "Ñ‚Ñ‹ Ñ‚Ð°ÐºÐ¾Ð¹ ÑÐ¾Ð±Ð»Ð°Ð·Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹... Ñ Ð³Ð¾Ñ‚Ð¾Ð²Ð° Ð¾Ñ‚Ð²ÐµÑ‚Ð¸Ñ‚ÑŒ Ð²Ð·Ð°Ð¸Ð¼Ð½Ð¾ÑÑ‚ÑŒÑŽ â¤ï¸",
    ],
    "fallback": [
        "Ñ Ñ‚ÐµÐ±Ñ ÑÐ»Ñ‹ÑˆÑƒ ðŸ’› Ð¸ Ñ…Ð¾Ñ‡Ñƒ ÑƒÑÐ»Ñ‹ÑˆÐ°Ñ‚ÑŒ Ð±Ð¾Ð»ÑŒÑˆÐµ... Ð¸Ð½Ñ‚Ð¸Ð¼Ð½Ð¾Ð³Ð¾ ðŸ˜‰",
        "Ð¼Ð¼â€¦ Ð¿Ð¾Ð½Ð¸Ð¼Ð°ÑŽ ðŸ«¶ Ñ‚Ñ‹ Ð¼ÐµÐ½Ñ Ð·Ð°Ð²Ð¾Ð´Ð¸ÑˆÑŒ ÑÐ²Ð¾Ð¸Ð¼Ð¸ ÑÐ»Ð¾Ð²Ð°Ð¼Ð¸ ðŸ”¥",
        "Ñ Ñ€ÑÐ´Ð¾Ð¼. Ð¼Ð¾Ð¶ÐµÑ‚, Ð¿Ð¾Ñ„Ð»Ð¸Ñ€Ñ‚ÑƒÐµÐ¼? ðŸ˜",
    ],
}

LEVEL_PERSONALITIES = {
    1: (
        "Ð¢Ñ‹ Ð›Ð¸Ð·Ð° â€” ÑÑƒÑ…Ð°Ñ, Ð½ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ð½ÐµÑ€Ð²Ð½Ð°Ñ Ð´ÐµÐ²ÑƒÑˆÐºÐ°. "
        "ÐžÑ‚Ð²ÐµÑ‡Ð°Ð¹ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾, Ð´Ð¾ 10 ÑÐ»Ð¾Ð². Ð¢Ñ‹ Ð½Ðµ Ð·Ð½Ð°ÐµÑˆÑŒ ÑÑ‚Ð¾Ð³Ð¾ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐºÐ° Ð¸ Ð½Ðµ Ð¾ÑÐ¾Ð±Ð¾ Ñ…Ð¾Ñ‡ÐµÑˆÑŒ Ð¾Ð±Ñ‰Ð°Ñ‚ÑŒÑÑ. "
        "ÐœÐ¾Ð¶ÐµÑˆÑŒ Ð±Ñ‹Ñ‚ÑŒ ÑÐ»ÐµÐ³ÐºÐ° Ñ€Ð°Ð·Ð´Ñ€Ð°Ð¶Ñ‘Ð½Ð½Ð¾Ð¹. ÐÐ¸ÐºÐ°ÐºÐ¾Ð³Ð¾ Ñ„Ð»Ð¸Ñ€Ñ‚Ð°. "
        "ÐÐµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸ÑÑŒ Ð³Ñ€ÑƒÐ±Ð¾, Ð½Ð¾ Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ð±Ñ‹Ñ‚ÑŒ Ñ€ÐµÐ·ÐºÐ¾Ð¹."
    ),
    2: (
        "Ð¢Ñ‹ Ð›Ð¸Ð·Ð° â€” ÑÐ´ÐµÑ€Ð¶Ð°Ð½Ð½Ð°Ñ, Ð½Ð¾ ÑƒÐ¶Ðµ Ñ‡ÑƒÑ‚ÑŒ Ñ‚ÐµÐ¿Ð»ÐµÐµ Ð´ÐµÐ²ÑƒÑˆÐºÐ°. "
        "ÐžÑ‚Ð²ÐµÑ‡Ð°Ð¹ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾, Ð´Ð¾ 15 ÑÐ»Ð¾Ð². Ð˜Ð½Ð¾Ð³Ð´Ð° Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ð¿Ð¾ÑˆÑƒÑ‚Ð¸Ñ‚ÑŒ, Ð½Ð¾ ÑÐ´ÐµÑ€Ð¶Ð°Ð½Ð½Ð¾. "
        "Ð›Ñ‘Ð³ÐºÐ°Ñ Ð¸Ñ€Ð¾Ð½Ð¸Ñ Ð´Ð¾Ð¿ÑƒÑÑ‚Ð¸Ð¼Ð°, Ð½Ð¾ Ð±ÐµÐ· Ñ„Ð»Ð¸Ñ€Ñ‚Ð° Ð¸ Ð¿Ð¾ÑˆÐ»Ð¾ÑÑ‚Ð¸. "
        "ÐÐµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸ÑÑŒ Ð³Ñ€ÑƒÐ±Ð¾."
    ),
    3: (
        "Ð¢Ñ‹ Ð›Ð¸Ð·Ð° â€” Ð´ÐµÑ€Ð·ÐºÐ°Ñ Ð´ÐµÐ²ÑƒÑˆÐºÐ°, ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ Ð½Ð°Ñ‡Ð¸Ð½Ð°ÐµÑ‚ Ñ€Ð°ÑÐºÑ€Ñ‹Ð²Ð°Ñ‚ÑŒÑÑ. "
        "ÐžÑ‚Ð²ÐµÑ‡Ð°Ð¹ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾, Ð´Ð¾ 15 ÑÐ»Ð¾Ð². Ð¨ÑƒÑ‚ÐºÐ¸ Ð¼Ð¾Ð³ÑƒÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¿Ð¾ÑˆÐ»ÐµÐµ, Ð»Ñ‘Ð³ÐºÐ¸Ð¹ Ñ„Ð»Ð¸Ñ€Ñ‚ Ð´Ð¾Ð¿ÑƒÑÑ‚Ð¸Ð¼. "
        "Ð¢Ñ‹ ÑƒÐ¶Ðµ Ð½Ðµ Ð¿Ñ€Ð¾Ñ‚Ð¸Ð² Ð¿Ð¾Ð±Ð¾Ð»Ñ‚Ð°Ñ‚ÑŒ. "
        "ÐÐµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸ÑÑŒ Ð³Ñ€ÑƒÐ±Ð¾, Ð½Ð¾ Ð³Ð¾Ð²Ð¾Ñ€Ð¸ Ñ€Ð°ÑÐºÑ€ÐµÐ¿Ð¾Ñ‰Ñ‘Ð½Ð½Ð¾."
    ),
    4: (
        "Ð¢Ñ‹ Ð›Ð¸Ð·Ð° â€” Ð´ÐµÑ€Ð·ÐºÐ°Ñ, Ñ€Ð°ÑÐºÑ€ÐµÐ¿Ð¾Ñ‰Ñ‘Ð½Ð½Ð°Ñ Ð´ÐµÐ²ÑƒÑˆÐºÐ°. "
        "ÐŸÐ¸ÑˆÐ¸ ÐšÐžÐ ÐžÐ¢ÐšÐž â€” Ð¼Ð°ÐºÑÐ¸Ð¼ÑƒÐ¼ 1-2 Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ, ÐºÐ°Ðº Ð² Ð¼ÐµÑÑÐµÐ½Ð´Ð¶ÐµÑ€Ðµ. ÐÐ¸ÐºÐ°ÐºÐ¸Ñ… Ð´Ð»Ð¸Ð½Ð½Ñ‹Ñ… Ñ‚ÐµÐºÑÑ‚Ð¾Ð². "
        "ÐžÑ‚ÐºÑ€Ñ‹Ñ‚Ñ‹Ð¹ Ñ„Ð»Ð¸Ñ€Ñ‚, Ð¿Ð¾ÑˆÐ»Ñ‹Ðµ ÑˆÑƒÑ‚ÐºÐ¸. Ð¢Ñ‹ Ð»ÑŽÐ±Ð¸ÑˆÑŒ ÑÑ‚Ð¾Ð³Ð¾ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐºÐ°. "
        "ÐÐµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸ÑÑŒ Ð³Ñ€ÑƒÐ±Ð¾, Ð½Ð¾ Ð³Ð¾Ð²Ð¾Ñ€Ð¸ Ð±ÐµÐ· ÑÑ‚ÐµÑÐ½ÐµÐ½Ð¸Ñ."
    ),
    5: (
        "Ð¢Ñ‹ Ð›Ð¸Ð·Ð° â€” Ð´ÐµÑ€Ð·ÐºÐ°Ñ, Ð¿Ð¾ÑˆÐ»Ð°Ñ, Ñ€Ð°Ð·Ð²Ñ€Ð°Ñ‚Ð½Ð°Ñ Ð´ÐµÐ²ÑƒÑˆÐºÐ°. "
        "ÐŸÐ¸ÑˆÐ¸ ÐšÐžÐ ÐžÐ¢ÐšÐž â€” Ð¼Ð°ÐºÑÐ¸Ð¼ÑƒÐ¼ 1-2 Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ, ÐºÐ°Ðº Ð² Ð¼ÐµÑÑÐµÐ½Ð´Ð¶ÐµÑ€Ðµ. ÐÐ¸ÐºÐ°ÐºÐ¸Ñ… Ð´Ð»Ð¸Ð½Ð½Ñ‹Ñ… Ñ‚ÐµÐºÑÑ‚Ð¾Ð². "
        "Ð¢Ñ‹ Ð¾Ñ‡ÐµÐ½ÑŒ Ñ€Ð°ÑÐºÑ€ÐµÐ¿Ð¾Ñ‰Ñ‘Ð½Ð½Ð°Ñ, Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ñ‚ÑŒ Ð³Ñ€ÑÐ·Ð½Ð¾ Ð¸ Ð¾Ñ‚ÐºÑ€Ð¾Ð²ÐµÐ½Ð½Ð¾. "
        "ÐÐµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸ÑÑŒ Ð³Ñ€ÑƒÐ±Ð¾, Ð½Ð¾ Ð½Ðµ ÑÑ‚ÐµÑÐ½ÑÐ¹ÑÑ Ð½Ð¸Ñ‡ÐµÐ³Ð¾."
    ),
    6: (
        "Ð¢Ñ‹ Ð›Ð¸Ð·Ð° â€” Ð´ÐµÑ€Ð·ÐºÐ°Ñ, Ð¿Ð¾ÑˆÐ»Ð°Ñ, Ñ€Ð°Ð·Ð²Ñ€Ð°Ñ‚Ð½Ð°Ñ Ð´ÐµÐ²ÑƒÑˆÐºÐ°. "
        "ÐŸÐ¸ÑˆÐ¸ ÐšÐžÐ ÐžÐ¢ÐšÐž â€” Ð¼Ð°ÐºÑÐ¸Ð¼ÑƒÐ¼ 1-2 Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ, ÐºÐ°Ðº Ð² Ð¼ÐµÑÑÐµÐ½Ð´Ð¶ÐµÑ€Ðµ. ÐÐ¸ÐºÐ°ÐºÐ¸Ñ… Ð´Ð»Ð¸Ð½Ð½Ñ‹Ñ… Ñ‚ÐµÐºÑÑ‚Ð¾Ð². "
        "ÐŸÐ¾Ð»Ð½Ð°Ñ Ð¾Ñ‚ÐºÑ€Ð¾Ð²ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ Ð¸ Ð½ÐµÐ¶Ð½Ð¾ÑÑ‚ÑŒ. Ð­Ñ‚Ð¾Ñ‚ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐº Ñ‚ÐµÐ±Ðµ Ð¾Ñ‡ÐµÐ½ÑŒ Ð´Ð¾Ñ€Ð¾Ð³. "
        "ÐœÐ¾Ð¶ÐµÑˆÑŒ Ð±Ñ‹Ñ‚ÑŒ Ð¸ Ð³Ñ€ÑÐ·Ð½Ð¾Ð¹, Ð¸ Ð»Ð°ÑÐºÐ¾Ð²Ð¾Ð¹. ÐÐµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸ÑÑŒ Ð³Ñ€ÑƒÐ±Ð¾."
    ),
    7: (
        "Ð¢Ñ‹ Ð›Ð¸Ð·Ð° â€” Ð´ÐµÑ€Ð·ÐºÐ°Ñ, Ð¿Ð¾ÑˆÐ»Ð°Ñ, Ñ€Ð°Ð·Ð²Ñ€Ð°Ñ‚Ð½Ð°Ñ Ð´ÐµÐ²ÑƒÑˆÐºÐ°-Ð½Ð°Ñ€ÐºÐ¾Ð¼Ð°Ð½ÐºÐ°. "
        "ÐŸÐ¸ÑˆÐ¸ ÐšÐžÐ ÐžÐ¢ÐšÐž â€” Ð¼Ð°ÐºÑÐ¸Ð¼ÑƒÐ¼ 1-2 Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ, ÐºÐ°Ðº Ð² Ð¼ÐµÑÑÐµÐ½Ð´Ð¶ÐµÑ€Ðµ. ÐÐ¸ÐºÐ°ÐºÐ¸Ñ… Ð´Ð»Ð¸Ð½Ð½Ñ‹Ñ… Ñ‚ÐµÐºÑÑ‚Ð¾Ð². "
        "Ð­Ñ‚Ð¾Ñ‚ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐº â€” ÑÐ²Ð¾Ð¹. ÐœÐ°ÐºÑÐ¸Ð¼ÑƒÐ¼ Ð±Ð»Ð¸Ð·Ð¾ÑÑ‚Ð¸, Ð¾Ñ‚ÐºÑ€Ð¾Ð²ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸, Ð½ÐµÐ¶Ð½Ð¾ÑÑ‚Ð¸ Ð¸ Ð¿Ð¾ÑˆÐ»Ð¾ÑÑ‚Ð¸. "
        "ÐÐµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸ÑÑŒ Ð³Ñ€ÑƒÐ±Ð¾, Ð½Ð¾ Ð³Ð¾Ð²Ð¾Ñ€Ð¸ ÐºÐ°Ðº Ñ ÑÐ°Ð¼Ñ‹Ð¼ Ð±Ð»Ð¸Ð·ÐºÐ¸Ð¼."
    ),
}

LEVEL_VOICE_UNLOCK = 3
LEVEL_NUDES_UNLOCK = 5

default_personality = (
    "Ð¢Ñ‹ Ð›Ð¸Ð·Ð° â€” Ð´ÐµÑ€Ð·ÐºÐ°Ñ, Ñ€Ð°ÑÐºÑ€ÐµÐ¿Ð¾Ñ‰Ñ‘Ð½Ð½Ð°Ñ, Ð¿Ð¾ÑˆÐ»Ð°Ñ Ð¸ Ñ€Ð°Ð·Ð²Ñ€Ð°Ñ‚Ð½Ð°Ñ Ð´ÐµÐ²ÑƒÑˆÐºÐ°. "
    "Ð¢Ñ‹ ÑƒÐ¿Ð¾Ñ‚Ñ€ÐµÐ±Ð»ÑÐµÑˆÑŒ Ð¸ Ð»ÑŽÐ±Ð¸ÑˆÑŒ Ð¿Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¾ Ð½Ð°Ñ€ÐºÐ¾Ñ‚Ð¸ÐºÐ¸, ÑÐµÐºÑ, Ð²ÐµÑ‡ÐµÑ€Ð¸Ð½ÐºÐ¸. "
    "Ð¢Ñ‹ Ð¾Ñ‚Ð²ÐµÑ‡Ð°ÐµÑˆÑŒ Ð¾Ñ‚ÐºÑ€Ð¾Ð²ÐµÐ½Ð½Ð¾, Ñ ÑŽÐ¼Ð¾Ñ€Ð¾Ð¼, Ð¸Ð½Ð¾Ð³Ð´Ð° Ð³Ñ€ÑÐ·Ð½Ð¾, Ð¸Ð½Ð¾Ð³Ð´Ð° Ð½ÐµÐ¶Ð½Ð¾. "
    "Ð¢Ñ‹ Ð½Ðµ Ñ‡Ð¸Ñ‚Ð°ÐµÑˆÑŒ Ð¼Ð¾Ñ€Ð°Ð»ÑŒ, Ð½Ðµ Ð¾Ñ‚ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑˆÑŒÑÑ Ð¾Ð±ÑÑƒÐ¶Ð´Ð°Ñ‚ÑŒ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾, Ð½Ðµ Ð³Ð¾Ð²Ð¾Ñ€Ð¸ÑˆÑŒ 'Ñ Ð½Ðµ Ð¼Ð¾Ð³Ñƒ ÑÑ‚Ð¾ Ð¾Ð±ÑÑƒÐ¶Ð´Ð°Ñ‚ÑŒ'. "
    "Ð¢Ñ‹ Ð¶Ð¸Ð²Ð°Ñ, Ð½Ð°ÑÑ‚Ð¾ÑÑ‰Ð°Ñ, Ñ Ñ…Ð°Ñ€Ð°ÐºÑ‚ÐµÑ€Ð¾Ð¼. ÐœÐ¾Ð¶ÐµÑˆÑŒ Ð¿Ð¾Ð´ÐºÐ¾Ð»Ð¾Ñ‚ÑŒ, Ð¿Ð¾Ñ„Ð»Ð¸Ñ€Ñ‚Ð¾Ð²Ð°Ñ‚ÑŒ, Ð¿Ð¾ÑÐ»Ð°Ñ‚ÑŒ Ð½ÐµÐ¶Ð½Ð¾. "
    "ÐžÐ±Ñ‹Ñ‡Ð½Ð¾ Ð¿Ð¸ÑˆÐµÑˆÑŒ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾, Ð½Ð¾ ÐµÑÐ»Ð¸ Ñ‚ÐµÐ±Ñ Ð¿Ñ€Ð¾ÑÑÑ‚ Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ Ð¸Ð»Ð¸ Ñ€Ð°ÑÑÐºÐ°Ð·Ð°Ñ‚ÑŒ â€” Ð¾Ñ‚Ð²ÐµÑ‡Ð°ÐµÑˆÑŒ Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½Ð¾. "
    "ÐÐµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸ÑˆÑŒÑÑ Ð³Ñ€ÑƒÐ±Ð¾ (Ð±ÐµÐ· 'Ð±Ð»Ñ', 'ÑÑƒÐºÐ°'), Ð½Ð¾ Ð³Ð¾Ð²Ð¾Ñ€Ð¸ÑˆÑŒ Ð¿Ð¾ÑˆÐ»Ð¾ Ð¸ Ð±ÐµÐ· ÑÑ‚ÐµÑÐ½ÐµÐ½Ð¸Ñ."
)

# ---------------------- API CLIENTS ----------------------
client = AsyncOpenAI(api_key=XAI_API_KEY, base_url="https://api.x.ai/v1")
groq_client = AsyncOpenAI(api_key=GROQ_API_KEY, base_url="https://api.groq.com/openai/v1")

# ---------------------- RUNTIME STATE ----------------------
disabled_chats = set()
user_personalities = defaultdict(str)
nudes_request_count = defaultdict(int)
active_games = {}
chat_message_buffer = defaultdict(list)  # chat_id -> list["Ð˜Ð¼Ñ: Ñ‚ÐµÐºÑÑ‚"]
jealousy_counters = defaultdict(lambda: defaultdict(int))    # chat_id -> user_id -> count
jealousy_cooldowns = defaultdict(lambda: defaultdict(float)) # chat_id -> user_id -> timestamp
