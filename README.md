# Лиза — Telegram-бот-компаньон

Дерзкая, раскрепощённая девушка-бот, которая иногда пишет первой, понимает голосовые, помнит настроение и не стесняется никаких тем.

**AI:** xAI Grok (grok-3-mini) + Groq Whisper (голосовые)

## Возможности

- **Ответы через Grok** — в личке отвечает всегда, в группах — по упоминанию, реплаю или случайно
- **Голосовые сообщения** — транскрибирует через Groq Whisper и отвечает текстом
- **Ежедневные чек-ины** — если давно не общались, напишет сама (quiet hours 23:00–9:00)
- **Память настроения** — распознаёт грусть / радость / злость / усталость по ключевым словам
- **Настроение Лизы** — глобальное настроение (playful, tender, bored, flirty, melancholic, wild), меняется каждые 2 часа с привязкой к времени суток, влияет на тон ответов и шансы спонтанных действий
- **Дешёвые реакции** — быстрые ответы без AI на приветствия, спасибо и т.д.
- **Typing indicator** — показывает "печатает..." и ждёт 1-4 сек перед ответом
- **Персонализация** — `/set_personality` меняет стиль общения
- **Blacklist** — бот работает везде по умолчанию, `/disable` отключает в чате

## Команды

| Команда | Описание |
|---|---|
| `/start` | Приветствие |
| `/help` | Список команд |
| `/disable` | Отключить бота в чате |
| `/reset` | Сбросить контекст разговора |
| `/set_personality <текст>` | Задать стиль общения |
| `/dontwritefirst` | Запретить писать первой |
| `/writefirst` | Разрешить писать первой |
| `/mood` | Показать запомненное настроение |
| `/clear_mood` | Очистить память настроения |
| `/mood_lisa` | Узнать текущее настроение Лизы |

## Установка

### Требования

- Python 3.10+
- PostgreSQL

### Зависимости

```bash
pip install -r requirements.txt
```

### Переменные окружения (.env)

```
TELEGRAM_TOKEN=123456:AAF...
XAI_API_KEY=xai-...
GROQ_API_KEY=gsk_...

DB_HOST=127.0.0.1
DB_PORT=5432
DB_NAME=companion_bot
DB_USER=postgres
DB_PASSWORD=yourpassword
```

### Запуск

```bash
python3 bot.py
```

## Деплой

Автоматический деплой через GitHub Actions при пуше в `dev`. На сервере работает как systemd unit (`asktelka.service`).

## Настройки

Константы в начале `bot.py`:

| Переменная | По умолчанию | Описание |
|---|---|---|
| `DUMB_MODE` | `True` | Короткие простые ответы |
| `MAX_WORDS` | `50` | Лимит слов в ответе |
| `RANDOM_GPT_RESPONSE_CHANCE` | `1/50` | Шанс случайного ответа в группе |
| `CHEAP_REACTION_CHANCE` | `1/12` | Шанс дешёвой реакции без AI |
| `CHECK_LONELY_INTERVAL_SEC` | `3 часа` | Частота проверки неактивных юзеров |
| `LISA_MOOD_UPDATE_INTERVAL_SEC` | `2 часа` | Частота смены настроения Лизы |
| `LOCAL_TZ` | `Europe/Podgorica` | Часовой пояс |
